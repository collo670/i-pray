<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar - iPray</title>
    <meta name="description" content="Liturgical calendar with daily information and prayer cycles">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/ipray/manifest.json">
    <meta name="theme-color" content="#7C3AED" id="theme-meta-color">

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class', // ✅ Required for dark: classes to work
            theme: {
                extend: {
                    colors: {
                        'primary': '#7C3AED',
                        'secondary': '#DB2777',
                        'accent': '#F59E0B',
                    },
                    backgroundImage: {
                        'vintage-texture': 'url("data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23000000\' fill-opacity=\'0.1\'%3E%3Ccircle cx=\'30\' cy=\'30\' r=\'2\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")',
                        'bg-gradient-vintage': 'linear-gradient(135deg, #f3e7ff 0%, #ffeaf0 50%, #e0f2fe 100%)',
                        'dark-gradient-vintage': 'linear-gradient(135deg, #4c1d95 0%, #7c2d12 50%, #075985 100%)',
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --primary-color: #7C3AED;
        }

        body {
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        /* Apply gradient based on mode */
        body {
            background: linear-gradient(135deg, #f3e7ff 0%, #ffeaf0 50%, #e0f2fe 100%);
        }

        body.dark {
            background: linear-gradient(135deg, #4c1d95 0%, #7c2d12 50%, #075985 100%);
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .liturgical-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .purple { background-color: #7C3AED; }
        .white { background-color: #FFFFFF; border: 1px solid #ddd; }
        .red { background-color: #DC2626; }
        .green { background-color: #16A34A; }
        .rose { background-color: #DB2777; }

        @media (max-width: 640px) {
            .bottom-nav {
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-vintage dark:bg-gradient-to-br dark:from-gray-900 dark:to-gray-800">
    <div id="app" class="relative z-10">
        <!-- Header -->
        <header class="px-6 py-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm shadow-sm sticky top-0 z-50">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 dark:from-purple-400 dark:to-pink-400 bg-clip-text text-transparent">
                        iPray
                    </h1>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        Liturgical Calendar
                    </p>
                </div>
                <button id="themeToggle" class="p-3 rounded-full bg-gray-800 text-white hover:bg-gray-700 dark:bg-yellow-400 dark:text-gray-900 dark:hover:bg-yellow-300 transition-all duration-300">
                    <svg id="themeIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <!-- Moon Icon (Dark Mode) -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-4xl mx-auto px-6 py-8 pb-24">
            <div class="space-y-6">
                <!-- Back Button & Title -->
                <div class="flex items-center justify-between">
                    <a href="index.html" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-800 dark:text-white transition-colors duration-200 shadow-sm">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                        Back to Home
                    </a>
                    <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 dark:from-purple-400 dark:to-pink-400 bg-clip-text text-transparent">
                        Liturgical Calendar
                    </h2>
                </div>

                <!-- Calendar Card -->
                <div class="rounded-2xl p-8 bg-white dark:bg-gray-800 shadow-xl">
                    <!-- Morning & Office Weeks -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div id="morningPrayer" class="p-6 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-gray-700 dark:to-gray-800 rounded-xl">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-3">Morning Prayer Week</h3>
                            <div class="text-3xl font-bold text-purple-600 dark:text-purple-400" id="morningWeek">Week 1</div>
                        </div>
                        <div id="officeReadings" class="p-6 bg-gradient-to-r from-green-50 to-teal-50 dark:from-gray-700 dark:to-gray-800 rounded-xl">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-3">Office of Readings Week</h3>
                            <div class="text-3xl font-bold text-green-600 dark:text-green-400" id="readingsWeek">Week 17</div>
                        </div>
                    </div>

                    <!-- Upcoming Events -->
                    <div class="mb-8">
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Upcoming Liturgical Events</h3>
                        <div id="upcomingEvents" class="space-y-3">
                            <!-- Filled by JavaScript -->
                        </div>
                    </div>

                    <!-- Liturgical Colors Guide -->
                    <div class="p-6 bg-gray-50 dark:bg-gray-700 rounded-xl">
                        <h4 class="font-semibold text-gray-800 dark:text-white mb-3">Liturgical Colors Guide</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="flex items-center">
                                <span class="liturgical-color purple"></span>
                                <span class="ml-2">Purple: Advent & Lent</span>
                            </div>
                            <div class="flex items-center">
                                <span class="liturgical-color white"></span>
                                <span class="ml-2">White: Christmas & Easter</span>
                            </div>
                            <div class="flex items-center">
                                <span class="liturgical-color red"></span>
                                <span class="ml-2">Red: Feasts of Martyrs</span>
                            </div>
                            <div class="flex items-center">
                                <span class="liturgical-color green"></span>
                                <span class="ml-2">Green: Ordinary Time</span>
                            </div>
                        </div>
                    </div>

                    <!-- Inspirational Quote -->
                    <div class="mt-8 pt-6 border-t border-dashed border-gray-300 dark:border-gray-700">
                        <p class="text-sm italic text-gray-600 dark:text-gray-300 text-center">
                            "The liturgical year is the celebration by the Church of the saving work of Christ. The Church celebrates the paschal mystery in the course of the year so that the entire mystery of Christ may be present and active." - General Norms for the Liturgical Year
                        </p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 px-6 py-4 shadow-lg bottom-nav">
            <div class="flex justify-around">
                <a href="index.html" class="flex flex-col items-center px-3 py-2 rounded-lg text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    <span class="text-xs font-medium">Home</span>
                </a>
                <a href="prayer.html" class="flex flex-col items-center px-3 py-2 rounded-lg text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                    <span class="text-xs font-medium">Prayer</span>
                </a>
                <a href="calendar.html" class="flex flex-col items-center px-3 py-2 rounded-lg text-purple-600 dark:text-purple-400">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span class="text-xs font-medium">Calendar</span>
                </a>
                <a href="settings.html" class="flex flex-col items-center px-3 py-2 rounded-lg text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    </svg>
                    <span class="text-xs font-medium">Settings</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- PWA Installation Prompt -->
    <div id="installPrompt" class="fixed bottom-20 left-0 right-0 bg-white dark:bg-gray-800 shadow-xl mx-4 p-4 rounded-lg hidden">
        <div class="flex items-center justify-between">
            <div>
                <p class="font-medium">Install iPray App?</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">Access calendar offline</p>
            </div>
            <div class="flex gap-2">
                <button id="dismissInstall" class="px-3 py-1 rounded-lg border border-gray-300 dark:border-gray-600">Later</button>
                <button id="installBtn" class="px-3 py-1 rounded-lg bg-purple-600 text-white">Install</button>
            </div>
        </div>
    </div>

    <script>
        // Update theme color meta tag
        function updateThemeMetaColor() {
            const meta = document.getElementById('theme-meta-color');
            if (document.body.classList.contains('dark')) {
                meta.setAttribute('content', '#1a1a1a');
            } else {
                meta.setAttribute('content', '#7C3AED');
            }
        }

        // Initialize theme
        function initTheme() {
            const savedMode = localStorage.getItem('themeMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const isDark = savedMode ? savedMode === 'dark' : prefersDark;

            if (isDark) {
                document.documentElement.classList.add('dark');
                document.body.classList.add('dark');
                // Sun icon
                document.getElementById('themeIcon').innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                `;
            } else {
                document.documentElement.classList.remove('dark');
                document.body.classList.remove('dark');
                // Moon icon
                document.getElementById('themeIcon').innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                `;
            }
            updateThemeMetaColor();
        }

        // Toggle theme
        document.getElementById('themeToggle').addEventListener('click', () => {
            const isDark = document.body.classList.contains('dark');
            if (isDark) {
                // Switch to light
                document.body.classList.remove('dark');
                document.documentElement.classList.remove('dark');
                localStorage.setItem('themeMode', 'light');
                document.getElementById('themeIcon').innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                `;
            } else {
                // Switch to dark
                document.body.classList.add('dark');
                document.documentElement.classList.add('dark');
                localStorage.setItem('themeMode', 'dark');
                document.getElementById('themeIcon').innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                `;
            }
            updateThemeMetaColor();
        });

        // Listen for theme changes in other tabs
        window.addEventListener('storage', (e) => {
            if (e.key === 'themeMode') {
                initTheme();
            }
        });

        // Calculate Easter (simplified algorithm)
        function calculateEaster(year) {
            const a = year % 19;
            const b = Math.floor(year / 100);
            const c = year % 100;
            const d = Math.floor(b / 4);
            const e = b % 4;
            const f = Math.floor((b + 8) / 25);
            const g = Math.floor((b - f + 1) / 3);
            const h = (19 * a + b - d - g + 15) % 30;
            const i = Math.floor(c / 4);
            const k = c % 4;
            const l = (32 + 2 * e + 2 * i - h - k) % 7;
            const m = Math.floor((a + 11 * h + 22 * l) / 451);
            const month = Math.floor((h + l - 7 * m + 114) / 31);
            const day = ((h + l - 7 * m + 114) % 31) + 1;
            return new Date(year, month - 1, day);
        }

        // Get liturgical season and feast
        function getLiturgicalInfo() {
            const today = new Date();
            const year = today.getFullYear();
            const easter = calculateEaster(year);
            const christmas = new Date(year, 11, 25);
            const ashWednesday = new Date(easter);
            ashWednesday.setDate(easter.getDate() - 46);
            const pentecost = new Date(easter);
            pentecost.setDate(easter.getDate() + 49);

            let season = 'Ordinary Time';
            let seasonColor = 'green';
            let feast = null;
            let feastType = null;

            // Check key dates
            if (today.getMonth() === 11 && today.getDate() === 25) {
                season = 'Christmas'; seasonColor = 'white'; feast = 'Nativity of the Lord'; feastType = 'Solemnity';
            } else if (today >= new Date(year, 11, 1) && today < christmas) {
                season = 'Advent'; seasonColor = 'purple';
            } else if (today >= christmas && today < new Date(year + 1, 0, 8)) {
                season = 'Christmas'; seasonColor = 'white';
            } else if (today >= ashWednesday && today < easter) {
                season = 'Lent'; seasonColor = 'purple';
            } else if (today >= easter && today < pentecost) {
                season = 'Easter'; seasonColor = 'white';
            } else if (today >= pentecost && today < new Date(year + 1, 11, 1)) {
                season = 'Ordinary Time'; seasonColor = 'green';
            }

            // Add feasts
            if (today.getDate() === 2 && today.getMonth() === 2) {
                feast = 'Presentation of the Lord'; feastType = 'Feast'; seasonColor = 'white';
            } else if (today.getDate() === 25 && today.getMonth() === 3) {
                feast = 'Annunciation of the Lord'; feastType = 'Solemnity'; seasonColor = 'white';
            } else if (today.getDate() === 1 && today.getMonth() === 10) {
                feast = 'All Saints'; feastType = 'Solemnity'; seasonColor = 'white';
            }

            return { season, seasonColor, feast, feastType };
        }

        // Get Morning Prayer Week (1–4 cycle)
        function getMorningPrayerWeek() {
            const start = new Date(new Date().getFullYear(), 0, 1);
            const diff = (new Date() - start) / (1000 * 60 * 60 * 24);
            const week = (Math.floor(diff / 7) % 4) + 1;
            return week;
        }

        // Get Office of Readings Week (17–34)
        function getOfficeReadingsWeek() {
            const start = new Date(new Date().getFullYear(), 0, 1);
            const diff = (new Date() - start) / (1000 * 60 * 60 * 24);
            const week = ((Math.floor(diff / 7) + 16) % 18) + 17;
            return `Week ${week}`;
        }

        // Generate upcoming events
        function getUpcomingEvents() {
            const today = new Date();
            const events = [];
            const year = today.getFullYear();
            const dates = [
                { date: new Date(year, 11, 25), name: 'Nativity of the Lord', type: 'Solemnity', color: 'white' },
                { date: new Date(year + 1, 0, 1), name: 'Mary, Mother of God', type: 'Solemnity', color: 'white' },
                { date: calculateEaster(year), name: 'Easter Sunday', type: 'Solemnity', color: 'white' },
                { date: new Date(calculateEaster(year).getTime() + 39 * 86400000), name: 'Ascension', type: 'Solemnity', color: 'white' },
                { date: new Date(calculateEaster(year).getTime() + 49 * 86400000), name: 'Pentecost', type: 'Solemnity', color: 'red' },
                { date: new Date(year, 0, 19), name: 'St. Joseph', type: 'Solemnity', color: 'white' },
                { date: new Date(year, 2, 19), name: 'St. Joseph', type: 'Solemnity', color: 'white' },
            ];

            const oneMonth = new Date(today);
            oneMonth.setDate(today.getDate() + 30);

            return dates
                .filter(e => e.date >= today && e.date <= oneMonth)
                .sort((a, b) => a.date - b.date)
                .slice(0, 5)
                .map(e => ({
                    date: e.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                    name: e.name,
                    type: e.type,
                    color: e.color
                }));
        }

        // Populate calendar
        function populateCalendar() {
            const info = getLiturgicalInfo();
            document.getElementById('morningWeek').textContent = `Week ${getMorningPrayerWeek()}`;
            document.getElementById('readingsWeek').textContent = getOfficeReadingsWeek();

            const eventsContainer = document.getElementById('upcomingEvents');
            const events = getUpcomingEvents();

            if (events.length === 0) {
                eventsContainer.innerHTML = '<p class="text-gray-600 dark:text-gray-300">No upcoming feasts.</p>';
            } else {
                events.forEach(e => {
                    const el = document.createElement('div');
                    el.className = 'flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg';
                    el.innerHTML = `
                        <span class="text-sm font-medium w-16 text-gray-600 dark:text-gray-300">${e.date}</span>
                        <div class="flex-1">
                            <div class="font-medium text-gray-800 dark:text-white">${e.name}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-300">${e.type}</div>
                        </div>
                        <span class="liturgical-color ${e.color}"></span>
                    `;
                    eventsContainer.appendChild(el);
                });
            }
        }

        // PWA Installation
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').classList.remove('hidden');
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') console.log('User accepted install');
                deferredPrompt = null;
                document.getElementById('installPrompt').classList.add('hidden');
            }
        });

        document.getElementById('dismissInstall').addEventListener('click', () => {
            document.getElementById('installPrompt').classList.add('hidden');
        });

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/ipray/service-worker.js')
                .then(() => console.log('SW registered'))
                .catch(err => console.log('SW failed:', err));
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            populateCalendar();
        });
    </script>
</body>
</html>