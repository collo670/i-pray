<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>prayer - iPray</title>
    <link rel="stylesheet" href="/assets/css/styles.css">
    <meta name="description" content="Daily prayers and devotions for Catholic faithful">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/ipray/manifest.json">
    <meta name="theme-color" content="#7C3AED" id="theme-meta-color">

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            darkMode: 'class', // âœ… Required for dark: utility classes
            theme: {
                extend: {
                    colors: {
                        'primary': '#7C3AED',
                        'secondary': '#DB2777',
                        'accent': '#F59E0B',
                    },
                    // Gradient for vintage background
                    backgroundImage: {
                        'bg-gradient-vintage': 'linear-gradient(135deg, #f3e7ff 0%, #ffeaf0 50%, #e0f2fe 100%)',
                        'dark-gradient-vintage': 'linear-gradient(135deg, #4c1d95 0%, #7c2d12 50%, #075985 100%)',
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --primary-color: #7C3AED;
        }

        body {
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        /* Apply gradient based on mode */
        body {
            background: linear-gradient(135deg, #f3e7ff 0%, #ffeaf0 50%, #e0f2fe 100%);
        }

        body.dark {
            background: linear-gradient(135deg, #4c1d95 0%, #7c2d12 50%, #075985 100%);
        }

        .prayer-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .prayer-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Border colors */
        .purple-border { border-left-color: #7C3AED; }
        .red-border { border-left-color: #DC2626; }
        .green-border { border-left-color: #16A34A; }
        .blue-border { border-left-color: #3B82F6; }
        .yellow-border { border-left-color: #F59E0B; }
        .pink-border { border-left-color: #DB2777; }

        .favorite-btn {
            transition: all 0.2s ease;
        }

        .favorite-btn:hover {
            transform: scale(1.1);
        }

        .favorite-btn.active {
            color: #DC2626;
        }

        @media (max-width: 640px) {
            .bottom-nav {
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-vintage dark:bg-gradient-to-br dark:from-gray-900 dark:to-gray-800">
    <div id="app" class="relative z-10">
        <!-- Header -->
        <header class="px-6 py-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm shadow-sm sticky top-0 z-50">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 dark:from-purple-400 dark:to-pink-400 bg-clip-text text-transparent">
                        ipray
                    </h1>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        daily prayers
                    </p>
                </div>
                <button id="themeToggle" class="p-3 rounded-full bg-gray-800 text-white hover:bg-gray-700 dark:bg-yellow-400 dark:text-gray-900 dark:hover:bg-yellow-300 transition-all duration-300">
                    <svg id="themeIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <!-- Sun Icon (Light Mode) -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-4xl mx-auto px-6 py-8 pb-24">
            <div class="space-y-6">
                <!-- Back Button & Title -->
                <div class="flex items-center justify-between">
                    <a href="index.html" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-800 dark:text-white transition-colors duration-200 shadow-sm">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                        Back to Home
                    </a>
                    <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 dark:from-purple-400 dark:to-pink-400 bg-clip-text text-transparent">
                        Daily Prayers
                    </h2>
                </div>

                <!-- Prayer Categories -->
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                    <button id="masifuAsubuhiLink"
                        class="category-btn p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium">
                        Lauds
                    </button>
                    <button onclick="location.href='#'"
                        class="category-btn p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium">
                        Evening
                    </button>
                    <button onclick="location.href='holy-rosary.html'"
                        class="category-btn p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium">
                        Rosary
                    </button>
                    <button onclick="location.href='sacraments.html'"
                        class="category-btn p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium">
                        Sacraments
                    </button>
                </div>

                <!-- Prayer List -->
                <div id="prayerList" class="space-y-4">
                    <!-- The Apostles' Creed -->
                    <div class="prayer-card purple-border rounded-xl p-6 bg-white dark:bg-gray-800 shadow-lg">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white">The Apostles' Creed</h3>
                            <button class="favorite-btn text-gray-400 hover:text-yellow-500" data-prayer="apostles-creed">
                                <i class="far fa-star"></i>
                            </button>
                        </div>
                        <div class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
                            I believe in God, the Father Almighty, Creator of Heaven and earth; and in Jesus Christ, His only Son Our Lord, who was conceived by the Holy Spirit, born of the Virgin Mary, suffered under Pontius Pilate, was crucified, died, and was buried. He descended into hell; the third day He rose again from the dead; He ascended into Heaven, and sitteth at the right hand of God, the Father Almighty; from thence He shall come to judge the living and the dead. I believe in the Holy Spirit, the holy Catholic Church, the communion of saints, the forgiveness of sins, the resurrection of the body, and life everlasting. Amen.
                        </div>
                    </div>

                    <!-- The Lord's Prayer -->
                    <div class="prayer-card red-border rounded-xl p-6 bg-white dark:bg-gray-800 shadow-lg">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white">The Lord's Prayer</h3>
                            <button class="favorite-btn text-gray-400 hover:text-yellow-500" data-prayer="lords-prayer">
                                <i class="far fa-star"></i>
                            </button>
                        </div>
                        <div class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
                            Our Father, who art in heaven, hallowed be thy name; thy kingdom come; thy will be done on earth as it is in heaven. Give us this day our daily bread; and forgive us our trespasses as we forgive those who trespass against us; and lead us not into temptation; but deliver us from evil. Amen.
                        </div>
                    </div>

                    <!-- The Hail Mary -->
                    <div class="prayer-card green-border rounded-xl p-6 bg-white dark:bg-gray-800 shadow-lg">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white">The Hail Mary</h3>
                            <button class="favorite-btn text-gray-400 hover:text-yellow-500" data-prayer="hail-mary">
                                <i class="far fa-star"></i>
                            </button>
                        </div>
                        <div class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
                            Hail Mary, full of grace, the Lord is with thee; blessed art thou among women, and blessed is the fruit of thy womb, Jesus. Holy Mary, Mother of God, pray for us sinners, now and at the hour of our death. Amen.
                        </div>
                    </div>

                    <!-- The Glory Be -->
                    <div class="prayer-card blue-border rounded-xl p-6 bg-white dark:bg-gray-800 shadow-lg">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white">The Glory Be</h3>
                            <button class="favorite-btn text-gray-400 hover:text-yellow-500" data-prayer="glory-be">
                                <i class="far fa-star"></i>
                            </button>
                        </div>
                        <div class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
                            Glory be to the Father, and to the Son, and to the Holy Spirit. As it was in the beginning, is now, and ever shall be, world without end. Amen.
                        </div>
                    </div>

                    <!-- The Hail Holy Queen -->
                    <div class="prayer-card yellow-border rounded-xl p-6 bg-white dark:bg-gray-800 shadow-lg">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white">The Hail Holy Queen</h3>
                            <button class="favorite-btn text-gray-400 hover:text-yellow-500" data-prayer="hail-holy-queen">
                                <i class="far fa-star"></i>
                            </button>
                        </div>
                        <div class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
                            Hail, holy Queen, Mother of mercy, our life, our sweetness, and our hope. To thee do we cry, poor banished children of Eve; to thee do we send up our sighs, mourning and weeping in this valley of tears. Turn then, most gracious advocate, thine eyes of mercy toward us; and after this our exile, show unto us the blessed fruit of thy womb, Jesus. O clement, O loving, O sweet Virgin Mary. Pray for us, O holy Mother of God, that we may be made worthy of the promises of Christ. Amen.
                        </div>
                    </div>

                    <!-- Morning Offering -->
                    <div class="prayer-card pink-border rounded-xl p-6 bg-white dark:bg-gray-800 shadow-lg">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white">Morning Offering</h3>
                            <button class="favorite-btn text-gray-400 hover:text-yellow-500" data-prayer="morning-offering">
                                <i class="far fa-star"></i>
                            </button>
                        </div>
                        <div class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
                            O Jesus, through the Immaculate Heart of Mary, I offer you my prayers, works, joys, and sufferings of this day for all the intentions of your Sacred Heart: the salvation of souls, the reparation for sin, the reunion of all Christians, and in particular for the intentions of the Holy Father this month. Amen.
                        </div>
                    </div>

                    <!-- Act of Contrition -->
                    <div class="prayer-card purple-border rounded-xl p-6 bg-white dark:bg-gray-800 shadow-lg">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white">Act of Contrition</h3>
                            <button class="favorite-btn text-gray-400 hover:text-yellow-500" data-prayer="act-of-contrition">
                                <i class="far fa-star"></i>
                            </button>
                        </div>
                        <div class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
                            O my God, I am heartily sorry for having offended Thee, and I detest all my sins because I dread the loss of Heaven and the pains of Hell, but most of all because they offend Thee, my God, Who art all-good and deserving of all my love. I firmly resolve, with the help of Thy grace, to confess my sins, to do penance, and to amend my life. Amen.
                        </div>
                    </div>

                    <!-- Prayer to St. Michael -->
                    <div class="prayer-card red-border rounded-xl p-6 bg-white dark:bg-gray-800 shadow-lg">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white">Prayer to St. Michael</h3>
                            <button class="favorite-btn text-gray-400 hover:text-yellow-500" data-prayer="st-michael">
                                <i class="far fa-star"></i>
                            </button>
                        </div>
                        <div class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
                            St. Michael the Archangel, defend us in battle. Be our protection against the wickedness and snares of the devil. May God rebuke him, we humbly pray; and do thou, O Prince of the heavenly host, by the power of God, cast into hell Satan and all the evil spirits who prowl about the world seeking the ruin of souls. Amen.
                        </div>
                    </div>
                </div>

                <!-- Favorites Section -->
                <div id="favoritesSection" class="hidden">
                    <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Favorite Prayers</h3>
                    <div id="favoritesList" class="space-y-4">
                        <!-- Favorites will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Inspirational Quote -->
                <div class="p-6 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-gray-700 dark:to-gray-800 rounded-xl">
                    <p class="text-center text-gray-600 dark:text-gray-300 italic">
                        "Pray without ceasing." - 1 Thessalonians 5:17
                    </p>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 px-6 py-4 shadow-lg bottom-nav">
            <div class="flex justify-around">
                <a href="index.html" class="flex flex-col items-center px-3 py-2 rounded-lg text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    <span class="text-xs font-medium">Home</span>
                </a>
                <a href="prayer.html" class="flex flex-col items-center px-3 py-2 rounded-lg text-purple-600 dark:text-purple-400">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                    <span class="text-xs font-medium">Prayer</span>
                </a>
                <a href="calendar.html" class="flex flex-col items-center px-3 py-2 rounded-lg text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span class="text-xs font-medium">Calendar</span>
                </a>
                <a href="settings.html" class="flex flex-col items-center px-3 py-2 rounded-lg text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    </svg>
                    <span class="text-xs font-medium">Settings</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- PWA Installation Prompt -->
    <div id="installPrompt" class="fixed bottom-20 left-0 right-0 bg-white dark:bg-gray-800 shadow-xl mx-4 p-4 rounded-lg hidden">
        <div class="flex items-center justify-between">
            <div>
                <p class="font-medium">Install iPray App?</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">Access prayers offline</p>
            </div>
            <div class="flex gap-2">
                <button id="dismissInstall" class="px-3 py-1 rounded-lg border border-gray-300 dark:border-gray-600">Later</button>
                <button id="installBtn" class="px-3 py-1 rounded-lg bg-purple-600 text-white">Install</button>
            </div>
        </div>
    </div>

    <script>
        // Masifu ya Asubuhi dynamic link
        const masifuAsubuhiLink = document.getElementById('masifuAsubuhiLink');
        if (masifuAsubuhiLink) {
            masifuAsubuhiLink.addEventListener('click', function() {
                const day = new Date().getDay();
                const dayToPrefix = ['jumapili', 'jumatatu', 'jumanne', 'jumatano', 'alhamisi', 'ijumaa', 'jumamosi'];
                const weekSequence = [1, 2, 3, 4];
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const daysSinceSunday = today.getDay();
                const referenceSunday = new Date(today);
                referenceSunday.setDate(today.getDate() - daysSinceSunday);
                const msPerWeek = 7 * 24 * 60 * 60 * 1000;
                const weeksSinceReference = Math.floor((today - referenceSunday) / msPerWeek);
                const weekIndex = weeksSinceReference % weekSequence.length;
                const week = weekSequence[weekIndex];
                const fileName = `${dayToPrefix[day]}${week}.html`;
                window.location.href = fileName;
            });
        }
        
        // Update theme color meta tag
        function updateThemeMetaColor() {
            const meta = document.getElementById('theme-meta-color');
            if (document.body.classList.contains('dark')) {
                meta.setAttribute('content', '#1a1a1a');
            } else {
                meta.setAttribute('content', '#7C3AED');
            }
        }

        // Initialize theme
        function initTheme() {
            const savedMode = localStorage.getItem('themeMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const isDark = savedMode ? savedMode === 'dark' : prefersDark;

            if (isDark) {
                document.documentElement.classList.add('dark');
                document.body.classList.add('dark');
                // Sun icon
                document.getElementById('themeIcon').innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                `;
            } else {
                document.documentElement.classList.remove('dark');
                document.body.classList.remove('dark');
                // Moon icon
                document.getElementById('themeIcon').innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                `;
            }
            updateThemeMetaColor();
        }

        // Toggle theme
        document.getElementById('themeToggle').addEventListener('click', () => {
            const isDark = document.body.classList.contains('dark');
            if (isDark) {
                // Switch to light
                document.body.classList.remove('dark');
                document.documentElement.classList.remove('dark');
                localStorage.setItem('themeMode', 'light');
                document.getElementById('themeIcon').innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                `;
            } else {
                // Switch to dark
                document.body.classList.add('dark');
                document.documentElement.classList.add('dark');
                localStorage.setItem('themeMode', 'dark');
                document.getElementById('themeIcon').innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                `;
            }
            updateThemeMetaColor();
        });

        // Listen for theme changes in other tabs
        window.addEventListener('storage', (e) => {
            if (e.key === 'themeMode') {
                initTheme();
            }
        });

        // Favorite prayers functionality
        function initFavorites() {
            const favorites = JSON.parse(localStorage.getItem('favoritePrayers') || '[]');
            document.querySelectorAll('.favorite-btn').forEach(btn => {
                const id = btn.getAttribute('data-prayer');
                if (favorites.includes(id)) {
                    btn.innerHTML = '<i class="fas fa-star"></i>';
                    btn.classList.add('active');
                }
                btn.addEventListener('click', function () {
                    const id = this.getAttribute('data-prayer');
                    const favorites = JSON.parse(localStorage.getItem('favoritePrayers') || '[]');
                    const index = favorites.indexOf(id);
                    if (index === -1) {
                        favorites.push(id);
                        this.innerHTML = '<i class="fas fa-star"></i>';
                        this.classList.add('active');
                    } else {
                        favorites.splice(index, 1);
                        this.innerHTML = '<i class="far fa-star"></i>';
                        this.classList.remove('active');
                    }
                    localStorage.setItem('favoritePrayers', JSON.stringify(favorites));
                    displayFavorites();
                });
            });
        }

        function displayFavorites() {
            const favorites = JSON.parse(localStorage.getItem('favoritePrayers') || '[]');
            const list = document.getElementById('favoritesList');
            const section = document.getElementById('favoritesSection');
            if (favorites.length === 0) {
                section.classList.add('hidden');
                return;
            }
            section.classList.remove('hidden');
            list.innerHTML = '';
            document.querySelectorAll('.prayer-card').forEach(card => {
                const id = card.querySelector('.favorite-btn').getAttribute('data-prayer');
                if (favorites.includes(id)) {
                    const clone = card.cloneNode(true);
                    const favBtn = clone.querySelector('.favorite-btn');
                    favBtn.outerHTML = '<button class="text-yellow-500"><i class="fas fa-star"></i></button>';
                    list.appendChild(clone);
                }
            });
        }

        // Category filtering
        function initCategories() {
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.category-btn').forEach(b => {
                        b.classList.remove('bg-purple-100', 'dark:bg-purple-900/30', 'text-purple-800', 'dark:text-purple-300');
                        b.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    });
                    this.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    this.classList.add('bg-purple-100', 'dark:bg-purple-900/30', 'text-purple-800', 'dark:text-purple-300');
                });
            });
        }

        // PWA Installation
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').classList.remove('hidden');
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') console.log('User accepted install');
                deferredPrompt = null;
                document.getElementById('installPrompt').classList.add('hidden');
            }
        });

        document.getElementById('dismissInstall').addEventListener('click', () => {
            document.getElementById('installPrompt').classList.add('hidden');
        });

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/ipray/service-worker.js')
                .then(() => console.log('SW registered'))
                .catch(err => console.log('SW registration failed:', err));
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            initFavorites();
            initCategories();
            displayFavorites();
        });
    </script>
</body>
</html>